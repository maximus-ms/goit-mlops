# HW-10 "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª–µ–π"

## üéØ –ú–µ—Ç–∞
- –°—Ç–≤–æ—Ä–∏—Ç–∏ Step Function –≤ AWS, —è–∫–∞ –∑–∞–ø—É—Å–∫–∞—î –ø–∞–π–ø–ª–∞–π–Ω —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑ –∫—ñ–ª—å–∫–æ—Ö –∫—Ä–æ–∫—ñ–≤;
- –°—Ç–≤–æ—Ä–∏—Ç–∏ Lambda-—Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –æ–∫—Ä–µ–º–∏—Ö –µ—Ç–∞–ø—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è);
- –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ Terraform;
- –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ GitLab CI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É Step Function –ø—Ä–∏ push.


## 1. –ó–∞–≤–¥–∞–Ω–Ω—è: –°—Ç–≤–æ—Ä–∏—Ç–∏ Lambda-—Ñ—É–Ω–∫—Ü—ñ—ó

–°—Ç–≤–æ—Ä–µ–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏:
- [validate.py](./terraform/lambda/validate.py)
- [train.py](./terraform/lambda/train.py)
- [log_metrics.py](./terraform/lambda/log_metrics.py)

–ê —Ç–∞–∫–æ–∂ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∞—Ä—Ö—ñ–≤–∏:
```bash
zip log_metrics.zip log_metrics.py
zip train.zip train.py
zip validate.zip validate.py
```
–¢–æ–∂ –º–∞—î–º–æ —Ñ–∞–π–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `./terraform/lambda`
```bash
log_metrics.py
log_metrics.zip
train.py
train.zip
validate.py
validate.zip
```

## 2. –ó–∞–≤–¥–∞–Ω–Ω—è: –ù–∞–ø–∏—Å–∞—Ç–∏ Terraform –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é

–ú–∞—î–º–æ —Ñ–∞–π–ª –∑ `Terrarorm` –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é
-  [main.tf](./terraform/main.tf)

–ó–∞–ø—É—Å–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≤ `AWS` –∑–∞–¥–æ–ø–æ–º–æ–≥–æ—é `Terraform`
```bash
terraform init
terraform apply
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —Å—Ç–≤–æ—Ä–µ–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ –Ω–∞ AWS

–ó–∞–≥–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫ –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü—ñ–π

![Lambda functions](./images/aws_lambda_functions.png)

–ü–µ—Ä–µ–≥–ª—è–Ω–µ–º–æ —Ñ—É–Ω–∫—Ü—ñ—é `trainModel`

![trainModel](./images/aws_lambda_train.png)

–í—ñ–¥–∫—Ä–∏—î–º–æ –Ω–∞—à—É step-—Ñ—É–Ω–∫—Ü—ñ—é `MLOpsPipeline`

![MLOpsPipeline](./images/aws_step_function.png)

–ü—Ä–æ–±—É—î–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω –≤—Ä—É—á–Ω—É —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î. –ó–≤–µ—Ä—Ç–∞—î–º–æ —É–≤–∞–≥—É, —â–æ `State input` –≤ –¥–∞–Ω–æ–º—É –≤–∏–ø–∞–¥–∫—É –ø—É—Å—Ç–∏–π.

![MLOpsPipeline manual trigger](./images/aws_step_function_manual_run.png)

## 3. –ó–∞–≤–¥–∞–Ω–Ω—è: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ GitLab CI

–ú–∞—î–º–æ —Ñ–∞–π–ª –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó CI/CD –≤ 
- [.gitlab-ci.yml](./.gitlab-ci.yml)

–°—Ç–≤–æ—Ä–∏–º–æ [GitLab —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π](https://gitlab.com/goit-mds2/mlops-hw10) —ñ –∑–∞–ø—É—à–∏–º–æ –≤ –Ω—å–æ–≥–æ —Ü–µ–π —Ñ–∞–π–ª.

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –±–∞—á–∏–º–æ, —â–æ –æ–¥—Ä–∞–∑—É –Ω–∞–º –¥–æ–¥–∞–≤—Å—è –ø–∞–π–ø–ª–∞–π–Ω, –∞–ª–µ –≤—ñ–Ω –∑–∞–≤–µ—Ä—à–∏–≤—Å—è –∑ –ø–æ–º–∏–ª–∫–æ—é

![GitLab create pipeline](./images/gitlab_first_commit.png)

–ü—Ä–∏—á–∏–Ω–∞ –ø–æ–º–∏–ª–∫–∏: –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∫–ª—é—á—ñ–≤ –¥–æ—Å—Ç—É–ø—É –¥–æ AWS

![GitLab no credantials](./images/gitlab_no_credentials.png)

–¢–æ–º—É –¥–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ `AWS_ACCESS_KEY_ID`, `AWS_ACCESS_KEY_ID` –¥–æ –ø—Ä–æ—î–∫—Ç—É

![GitLab variables](./images/gitlab_variables.png)

–ü—É—à–∞—î–º–æ —â–µ –æ–¥–Ω–∏ –∫–æ–º—ñ—Ç –≤ `GitLab` —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–æ–±–æ—Ç—É CI/CD

![GitLab good flow](./images/gitlab_good_flow.png)

–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–±–æ—Ç–∏ –Ω–∞ AWS, –±–∞—á–∏–º–æ 2 –∑–∞–ø—É—Å–∫–∏ –Ω–∞—à–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω—É. –ü–µ—Ä—à–∏–π, —Ç–æ–π —â–æ –º–∏ —Ä–æ–±–∏–ª–∏ –≤—Ä—É—á–Ω—É –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è. –î—Ä—É–≥–∏–π - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—â–µ–Ω–∏–π –∑ GitLab.

![AWS good flow](./images/aws_cicd_run.png)

–í—ñ–¥–∫—Ä–∏—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∑–∞–ø—É—Å–∫ —â–æ –±—É–ª–æ —ñ–Ω—ñ—Ü—ñ–π–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ –π–æ–≥–æ –≤—Ö—ñ–¥–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.

![AWS pipeline input data](./images/aws_pipeline_input_data.png)