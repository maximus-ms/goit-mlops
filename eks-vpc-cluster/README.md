# HW-5. «Kubernetes для MLOps»

## Структура проєкту
```
eks-vpc-cluster/
├── backend.tf         # Конфігурація бекенду Terraform для зберігання стану
├── main.tf            # Головний файл конфігурації, підключає модулі
├── outputs.tf         # Вихідні змінні кореневого модуля
├── terraform.tf       # Налаштування провайдерів та версій Terraform
├── variables.tf       # Змінні кореневого модуля
├── eks/               # Модуль для розгортання EKS кластера
│   ├── backend.tf     # Конфігурація бекенду для модуля EKS
│   ├── main.tf        # Конфігурація EKS кластера
│   ├── outputs.tf     # Вихідні змінні EKS модуля
│   ├── terraform.tf   # Налаштування провайдерів для EKS
│   └── variables.tf   # Змінні EKS модуля
└── vpc/               # Модуль для створення VPC
    ├── backend.tf     # Конфігурація бекенду для модуля VPC
    ├── main.tf        # Конфігурація VPC
    ├── outputs.tf     # Вихідні змінні VPC модуля
    ├── terraform.tf   # Налаштування провайдерів для VPC
    └── variables.tf   # Змінні VPC модуля
```

## Опис проєкту

Проєкт містить Terraform конфігурацію для розгортання Amazon EKS кластера з необхідною мережевою інфраструктурою (VPC). Проєкт розділений на два основні модулі:

1. **VPC модуль** - створює мережеву інфраструктуру з публічними та приватними підмережами в різних зонах доступності.
2. **EKS модуль** - розгортає Kubernetes кластер у створеній VPC.

## Передумови

Для використання цього проєкту вам потрібно:

1. Встановлений Terraform (версія >= 1.5.0)
2. AWS CLI з налаштованим профілем `goit-terraform`
3. Права доступу до AWS для створення необхідних ресурсів
4. S3 бакет для зберігання стану Terraform (вказаний у backend.tf)

## Інструкція з використання

### 1. Клонування репозиторію

```bash
git clone <URL-репозиторію>
cd goit-mlops
git checkout lesson-5-6
cd eks-vpc-cluster
```

### 2. Ініціалізація Terraform

```bash
terraform init
```

### 3. Перевірка плану розгортання

```bash
terraform plan
```

### 4. Розгортання інфраструктури

```bash
terraform apply
```

Підтвердіть розгортання, ввівши `yes` після перегляду плану.

### 5. Налаштування доступу до кластера

Після успішного розгортання, налаштуйте kubectl для роботи з вашим EKS кластером:

```bash
aws eks update-kubeconfig --name <назва-кластера> --region us-east-1 --profile goit-terraform
```

Назву кластера можна отримати з виводу `terraform output`.

### 6. Перевірка кластера

Перевірте, що кластер працює коректно:

```bash
kubectl get nodes
kubectl get pods --all-namespaces
```

### 7. Видалення інфраструктури

Коли кластер більше не потрібен, ви можете видалити всі створені ресурси:

```bash
terraform destroy
```

## Особливості конфігурації

- **Версії провайдерів**: Проєкт використовує AWS провайдер версії >= 5.0, < 6.0
- **VPC модуль**: Використовується terraform-aws-modules/vpc/aws версії ~> 5.0
- **Зберігання стану**: Стан Terraform зберігається в S3 бакеті
- **Профіль AWS**: Використовується профіль `goit-terraform`

## Змінні проєкту

Основні змінні, які можна налаштувати:

- `project_name` - Префікс для імен ресурсів
- `aws_region` - Регіон AWS для розгортання (за замовчуванням: us-east-1, необхідно також змінити в налаштуваннях бекенду)

## Вихідні дані

Після розгортання доступні наступні вихідні дані:

- `vpc_id` - ID створеної VPC
- `public_subnets` - Список ID публічних підмереж
- `private_subnets` - Список ID приватних підмереж
- `eks_cluster_name` - Назва EKS кластера
- `eks_cluster_endpoint` - Endpoint для доступу до API сервера Kubernetes
